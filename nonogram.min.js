var nonogram=function(a){"use strict";var b=Math.min,d=Math.SQRT1_2,e=Math.PI,f=Math.floor;function g(a,b){return a.length===b.length&&a.every((a,c)=>a===b[c])}function h(a){try{return n.createObjectURL(new Blob([a],{type:"application/javascript"}))}catch(c){var b=new m;return b.append(a),n.createObjectURL(b.getBlob(type))}}var i={greyVeryLight:"#ccc",grey:"#555",greyVeryDark:"#111",blue:"#0ebeff",green:"#47cf73",violet:"#ae63e4",yellow:"#fcd000",red:"#ff3c41"};const c={EMPTY:0,FILLED:1,UNSET:2,TEMP_FILLED:3,TEMP_EMPTY:4,INCONSTANT:5};class k{constructor(){this.listeners=[],this.m=0,this.n=0,this.grid=[],this.hints={row:[],column:[]},this.theme={filledColor:i.grey,unsetColor:i.greyVeryLight,correctColor:i.green,wrongColor:i.red,meshColor:i.yellow,isMeshed:!1,isBoldMeshOnly:!1,isMeshOnTop:!1,boldMeshGap:5}}get canvas(){return this._canvas}get ctx(){return this._ctx}initCanvas(a){let b=a instanceof HTMLCanvasElement?a:document.getElementById(a);b instanceof HTMLCanvasElement||(b=document.createElement("canvas")),this._canvas=b,this.canvas.nonogram&&this.canvas.nonogram.listeners.forEach(([a,b])=>{this.canvas.removeEventListener(a,b)}),this.canvas.nonogram=this,this.canvas.width=this.theme.width||this.canvas.clientWidth,this.canvas.height=this.canvas.width*(this.m+1)/(this.n+1),this._ctx=this.canvas.getContext("2d")||new CanvasRenderingContext2D,this.initListeners(),this.listeners.forEach(([a,b])=>{this.canvas.addEventListener(a,b)}),this.canvas.oncontextmenu=a=>{a.preventDefault()}}initListeners(){this.listeners=[]}removeNonPositiveHints(){function a(a,b,c){c[b]=a.filter(a=>0<a)}this.hints.row.forEach(a),this.hints.column.forEach(a)}static getSingleLine(a,b,c){const d=a.length,e=a.length?a[0].length:0,f=[];if("row"===b)for(let b=0;b<e;b+=1)f[b]=a[c][b];else if("column"===b)for(let b=0;b<d;b+=1)f[b]=a[b][c];return f}static calculateHints(a,b,d){const e=[],f=k.getSingleLine(a,b,d);return f.reduce((a,b)=>{if(b===c.FILLED)e.push(a?e.pop()+1:1);else if(b!==c.EMPTY)throw new Error;return b===c.FILLED},!1),e}isLineCorrect(a,b){try{return g(k.calculateHints(this.grid,a,b),this.hints[a][b])}catch(a){return!1}}getLocation(a,b){const c=this.canvas.getBoundingClientRect(),e=c.width,f=c.height,g=2*e/3,h=2*f/3,i=g/(this.n+1);return 0>a||a>=e||0>b||b>=f?"outside":0<=a&&a<=g&&0<=b&&b<h?i/2<=a&&a<g-i/2&&i/2<=b&&b<h-i/2?"grid":"limbo":g<=a&&a<e&&h<=b&&b<f?"controller":"hints"}print(){this.printGrid(),this.printHints(),this.printController()}printGrid(){const{ctx:a}=this,{width:b,height:c}=this.canvas,e=2*b/3/(this.n+1);a.clearRect(-1,-1,2*b/3+1,2*c/3+1),this.theme.isMeshed&&!this.theme.isMeshOnTop&&this.printMesh(),a.save(),a.translate(e/2,e/2);for(let b=0;b<this.m;b+=1)for(let c=0;c<this.n;c+=1)a.save(),a.translate(e*c,e*b),this.printCell(this.grid[b][c]),a.restore();a.restore(),this.theme.isMeshed&&this.theme.isMeshOnTop&&this.printMesh()}printCell(a){const{ctx:b}=this,e=2*this.canvas.width/3/(this.n+1);a===c.UNSET?(b.fillStyle=this.theme.unsetColor,b.fillRect(.05*e,.05*e,.9*e,.9*e)):a===c.FILLED?(b.fillStyle=this.theme.filledColor,b.fillRect(.05*-e,.05*-e,1.1*e,1.1*e)):void 0}printMesh(){const{ctx:a}=this,b=2*this.canvas.width/3/(this.n+1);a.save(),a.translate(b/2,b/2),a.beginPath();for(let c=1;c<this.m;c+=1)this.theme.isBoldMeshOnly||(a.moveTo(0,c*b),a.lineTo(this.n*b,c*b)),0==c%this.theme.boldMeshGap&&(a.moveTo(0,c*b),a.lineTo(this.n*b,c*b),!this.theme.isBoldMeshOnly&&(a.moveTo(0,c*b-1),a.lineTo(this.n*b,c*b-1),a.moveTo(0,c*b+1),a.lineTo(this.n*b,c*b+1)));for(let c=1;c<this.n;c+=1)this.theme.isBoldMeshOnly||(a.moveTo(c*b,0),a.lineTo(c*b,this.m*b)),0==c%this.theme.boldMeshGap&&(a.moveTo(c*b,0),a.lineTo(c*b,this.m*b),!this.theme.isBoldMeshOnly&&(a.moveTo(c*b-1,0),a.lineTo(c*b-1,this.m*b),a.moveTo(c*b+1,0),a.lineTo(c*b+1,this.m*b)));a.lineWidth=1,a.strokeStyle=this.theme.meshColor,a.stroke(),a.restore()}printHints(){const{ctx:a}=this,{width:b,height:c}=this.canvas,e=2*b/3/(this.n+1);a.clearRect(2*b/3-1,-1,3*b+1,2*c/3+1),a.clearRect(-1,2*c/3-1,2*b/3+1,c/3+1),a.save(),a.translate(e/2,e/2);for(let a=0;a<this.m;a+=1){for(let b=0;b<this.hints.row[a].length;b+=1)this.printSingleHint("row",a,b);0===this.hints.row[a].length&&this.printSingleHint("row",a,0)}for(let a=0;a<this.n;a+=1){for(let b=0;b<this.hints.column[a].length;b+=1)this.printSingleHint("column",a,b);0===this.hints.column[a].length&&this.printSingleHint("column",a,0)}a.restore()}printSingleHint(a,b,c){const{ctx:e}=this,{width:f,height:g}=this.canvas,h=2*f/3/(this.n+1);e.textAlign="center",e.textBaseline="middle",e.font=`${h}pt "Courier New", Inconsolata, Consolas, monospace`;const d=this.hints[a][b];e.fillStyle=d.isCorrect?this.theme.correctColor:this.theme.wrongColor,e.globalAlpha=!d.isCorrect&&d.unchanged?.5:1,"row"===a?e.fillText(`${this.hints.row[b][c]||0}`,2*f/3+h*c,h*(b+.5),.8*h):"column"==a&&e.fillText(`${this.hints.column[b][c]||0}`,h*(b+.5),2*g/3+h*c,.8*h)}}var l="undefined"==typeof Symbol?"__target":Symbol(),m=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,n=window.URL||window.webkitURL,p=window.Worker;if(p){var q,r=h("self.onmessage = function () {}"),s=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw new Error("Not available");q=new p(r),q.postMessage(s,[s.buffer])}catch(a){p=null}finally{n.revokeObjectURL(r),q&&q.terminate()}}var t=new function(a,b){return function(c){var d=this;if(!b)return new p(a);if(p&&!c){var e=`${b}`.replace(/^function.+?{/,"").slice(0,-1),f=h(e);return this[l]=new p(f),n.revokeObjectURL(f),this[l]}var g={postMessage:a=>{d.onmessage&&setTimeout(()=>d.onmessage({data:a,target:g}))}};b.call(g),this.postMessage=a=>{setTimeout(()=>g.onmessage({data:a,target:d}))},this.isThisThread=!0}}("./worker.ts",function(){function a(a,b){return a.length===b.length&&a.every((a,c)=>a===b[c])}const b={EMPTY:0,FILLED:1,UNSET:2,TEMP_FILLED:3,TEMP_EMPTY:4,INCONSTANT:5},c=new Map;c.set(b.TEMP_FILLED,b.FILLED),c.set(b.TEMP_EMPTY,b.EMPTY),c.set(b.INCONSTANT,b.UNSET);class d{constructor(a){this.isError=!1,this.currentHints=[],this.currentLine=[],this.iterations=0,this.scan=()=>{if(this.iterations+=1,!!this.updateScanner()){this.delay&&(this.message={type:"update",grid:this.grid,scanner:this.scanner,hints:this.hints},postMessage(this.message)),this.isError=!0;const{direction:a,i:c}=this.scanner;this.currentHints=this.hints[a][c],this.currentHints.unchanged=!0,this.currentLine=d.getSingleLine(this.grid,a,c);const e=this.currentLine.every(a=>a!==b.UNSET);return e||(this.solveSingleLine(),this.setBackToGrid(this.currentLine)),this.isLineCorrect(a,c)&&(this.hints[a][c].isCorrect=!0,this.isError=!1),this.isError?(this.message={type:"error",grid:this.grid,scanner:this.scanner,hints:this.hints},void postMessage(this.message)):void(this.delay?setTimeout(this.scan,this.delay):this.scan())}},this.hints=a.hints,this.delay=a.delay,this.grid=a.grid,this.scanner={direction:"row",i:-1},this.possibleBlanks={row:[],column:[]},this.scan()}static getSingleLine(a,b,c){const d=a.length,e=a.length?a[0].length:0,f=[];if("row"===b)for(let b=0;b<e;b+=1)f[b]=a[c][b];else if("column"===b)for(let b=0;b<d;b+=1)f[b]=a[b][c];return f}static calculateHints(a,c,e){const f=[],g=d.getSingleLine(a,c,e);return g.reduce((a,c)=>{if(c===b.FILLED)f.push(a?f.pop()+1:1);else if(c!==b.EMPTY)throw new Error;return c===b.FILLED},!1),f}isLineCorrect(b,c){try{return a(d.calculateHints(this.grid,b,c),this.hints[b][c])}catch(a){return!1}}updateScanner(){let a;do if(this.isError=!1,this.scanner.i+=1,void 0===this.hints[this.scanner.direction][this.scanner.i]&&(this.scanner.direction="row"===this.scanner.direction?"column":"row",this.scanner.i=0),a=this.hints[this.scanner.direction][this.scanner.i],this.hints.row.every(a=>!!a.unchanged)&&this.hints.column.every(a=>!!a.unchanged))return this.message={type:"finish",grid:this.grid,hints:this.hints,iterations:this.iterations},postMessage(this.message),!1;while(a.isCorrect||a.unchanged);return!0}setBackToGrid(a){const{direction:b,i:d}=this.scanner;"row"===b?a.forEach((a,b)=>{c.has(a)&&this.grid[d][b]!==c.get(a)&&(this.grid[d][b]=c.get(a),this.hints.column[b].unchanged=!1)}):"column"===b&&a.forEach((a,b)=>{c.has(a)&&this.grid[b][d]!==c.get(a)&&(this.grid[b][d]=c.get(a),this.hints.row[b].unchanged=!1)})}solveSingleLine(){this.isError=!0;const{direction:a,i:b}=this.scanner;void 0===this.possibleBlanks[a][b]&&(this.possibleBlanks[a][b]=[],this.findAll(this.currentLine.length)),this.merge()}findAll(a,b=[],c=0){if(c===this.currentHints.length){const a=b.slice(0,this.currentHints.length),{direction:c,i:d}=this.scanner;this.possibleBlanks[c][d].push(a)}for(let d=c?1:0;d<=a;d+=1){b[c]=d;const e=a-d-this.currentHints[c];0<=e&&this.findAll(e,b,c+1)}}merge(){const{direction:a,i:c}=this.scanner,d=this.possibleBlanks[a][c];d.forEach((a,c)=>{const e=[];for(let d=0;d<this.currentHints.length;d+=1)e.push(...Array(a[d]).fill(b.TEMP_EMPTY)),e.push(...Array(this.currentHints[d]).fill(b.TEMP_FILLED));e.push(...Array(this.currentLine.length-e.length).fill(b.TEMP_EMPTY));const f=e.some((a,c)=>a===b.TEMP_EMPTY&&this.currentLine[c]===b.FILLED||a===b.TEMP_FILLED&&this.currentLine[c]===b.EMPTY);return f?void delete d[c]:void(this.isError=!1,e.forEach((a,c)=>{a===b.TEMP_FILLED?this.currentLine[c]===b.TEMP_EMPTY?this.currentLine[c]=b.INCONSTANT:this.currentLine[c]===b.UNSET&&(this.currentLine[c]=b.TEMP_FILLED):a===b.TEMP_EMPTY&&(this.currentLine[c]===b.TEMP_FILLED?this.currentLine[c]=b.INCONSTANT:this.currentLine[c]===b.UNSET&&(this.currentLine[c]=b.TEMP_EMPTY))}))}),this.possibleBlanks[a][c]=d.filter(a=>a)}}onmessage=({data:a})=>{new d(a)}});class u extends k{constructor(a,b,d,{theme:e={},grid:g=[],threshold:h=.5,onHintChange:j=()=>{}}={}){super(),this.draw={},this.isPressed=!1,this.mousedown=a=>{const b=this.canvas.getBoundingClientRect(),e=a.clientX-b.left,g=a.clientY-b.top,h=2*b.width/3/(this.n+1),d=this.getLocation(e,g);if("controller"===d)this.refresh();else if("grid"===d){this.draw.firstI=f(g/h-.5),this.draw.firstJ=f(e/h-.5);const a=this.grid[this.draw.firstI][this.draw.firstJ];this.draw.brush=a===c.FILLED?c.EMPTY:c.FILLED,this.isPressed=!0,this.paintCell(this.draw.firstI,this.draw.firstJ),this.draw.lastI=this.draw.firstI,this.draw.lastJ=this.draw.firstJ}},this.mousemove=a=>{if(this.isPressed){const b=this.canvas.getBoundingClientRect(),c=a.clientX-b.left,e=a.clientY-b.top,g=2*b.width/3/(this.n+1);if("grid"===this.getLocation(c,e)){const a=f(e/g-.5),b=f(c/g-.5);(a!==this.draw.lastI||b!==this.draw.lastJ)&&(void 0===this.draw.direction&&(a===this.draw.firstI?this.draw.direction="row":b===this.draw.firstJ&&(this.draw.direction="column")),("row"===this.draw.direction&&a===this.draw.firstI||"column"===this.draw.direction&&b===this.draw.firstJ)&&(this.paintCell(a,b),this.draw.lastI=a,this.draw.lastJ=b))}}},this.brushUp=()=>{this.isPressed=!1,this.draw={}},this.theme.filledColor=i.violet,this.theme.correctColor=i.violet,Object.assign(this.theme,e),this.threshold=h,this.handleHintChange=j,this.m=a,this.n=b,this.grid=Array(this.m);for(let f=0;f<this.m;f+=1){this.grid[f]=Array(this.n);for(let a=0;a<this.n;a+=1)this.grid[f][a]=g.length?g[f]&&g[f][a]?c.FILLED:c.EMPTY:Math.random()<this.threshold?c.FILLED:c.EMPTY}this.hints=u.getHints(this.grid),this.initCanvas(d),this.print(),this.handleHintChange(this.hints.row,this.hints.column)}static getHints(a){const b=a.length,c=a.length?a[0].length:0,d={row:Array(b),column:Array(c)};for(let c=0;c<b;c+=1)d.row[c]=k.calculateHints(a,"row",c),d.row[c].isCorrect=!0;for(let b=0;b<c;b+=1)d.column[b]=k.calculateHints(a,"column",b),d.column[b].isCorrect=!0;return d}initListeners(){this.listeners=[["mousedown",this.mousedown],["mousemove",this.mousemove],["mouseup",this.brushUp],["mouseleave",this.brushUp]]}paintCell(a,b){this.grid[a][b]=this.draw.brush,this.hints.row[a]=k.calculateHints(this.grid,"row",a),this.hints.row[a].isCorrect=!0,this.hints.column[b]=k.calculateHints(this.grid,"column",b),this.hints.column[b].isCorrect=!0,this.print(),this.handleHintChange(this.hints.row,this.hints.column)}refresh(){for(let a=0;a<this.m;a+=1)for(let b=0;b<this.n;b+=1)this.grid[a][b]=Math.random()<this.threshold?c.FILLED:c.EMPTY;for(let a=0;a<this.m;a+=1)this.hints.row[a]=k.calculateHints(this.grid,"row",a),this.hints.row[a].isCorrect=!0;for(let a=0;a<this.n;a+=1)this.hints.column[a]=k.calculateHints(this.grid,"column",a),this.hints.column[a].isCorrect=!0;this.print(),this.handleHintChange(this.hints.row,this.hints.column)}printController(){const{ctx:a}=this,{width:c,height:f}=this.canvas,g=b(c,f)/4,h=this.theme.filledColor;a.clearRect(2*c/3-1,2*f/3-1,c/3+1,f/3+1),a.save(),a.translate(.7*c,.7*f),a.drawImage(function(){const a=document.createElement("canvas"),b=g/10;a.width=g,a.height=g;const f=a.getContext("2d")||new CanvasRenderingContext2D;return f.translate(g/2,g/2),f.arc(0,0,g/2-b/2,e/2,e/3.9),f.lineWidth=b,f.strokeStyle=h,f.stroke(),f.beginPath(),f.moveTo((g/2+b)*d,(g/2+b)*d),f.lineTo((g/2-2*b)*d,(g/2-2*b)*d),f.lineTo((g/2-2*b)*d,(g/2+b)*d),f.closePath(),f.fillStyle=h,f.fill(),a}(),0,0),a.restore()}}return a.Solver=class extends k{constructor(a,b,d,{theme:e={},delay:g=50,onSuccess:h=()=>{},onError:j=()=>{}}={}){super(),this.worker=new t,this.isBusy=!1,this.isError=!1,this.click=a=>{if(this.isBusy)return;const b=this.canvas.getBoundingClientRect(),e=a.clientX-b.left,g=a.clientY-b.top,h=2*b.width/3/(this.n+1),d=this.getLocation(e,g);if("grid"===d){if(this.isError)return;const a=f(g/h-.5),b=f(e/h-.5);this.grid[a][b]===c.UNSET&&(this.grid[a][b]=c.FILLED,this.hints.row[a].unchanged=!1,this.hints.column[b].unchanged=!1,this.solve())}else"controller"===d&&this.refresh()},this.theme.filledColor=i.green,this.theme.correctColor=i.green,this.theme.wrongColor=i.yellow,Object.assign(this.theme,e),this.delay=g,this.handleSuccess=h,this.handleError=j,this.hints={row:a.slice(),column:b.slice()},this.removeNonPositiveHints(),this.m=this.hints.row.length,this.n=this.hints.column.length,this.grid=Array(this.m);for(let f=0;f<this.m;f+=1)this.grid[f]=Array(this.n).fill(c.UNSET);this.initCanvas(d),this.print()}initListeners(){this.listeners=[["click",this.click]]}refresh(){this.grid=Array(this.m);for(let a=0;a<this.m;a+=1)this.grid[a]=Array(this.n).fill(c.UNSET);this.hints.row.forEach(a=>{a.isCorrect=!1,a.unchanged=!1}),this.hints.column.forEach(a=>{a.isCorrect=!1,a.unchanged=!1}),this.solve()}solve(){if(this.isBusy)return;this.print(),this.isBusy=!0;const a=Date.now();this.worker.onmessage=({data:b})=>{if(this.canvas.nonogram!==this)return void this.worker.terminate();if(this.scanner=b.scanner,this.grid=b.grid,this.hints=b.hints,"update"!==b.type)if(this.isBusy=!1,"error"===b.type){this.isError=!0;const{direction:a,i:b}=this.scanner;this.handleError(new Error(`Bad hints at ${a} ${b+1}`))}else if("finish"===b.type){this.isError=!1;const d=this.grid.every(a=>a.every(a=>a!==c.UNSET));this.handleSuccess(Date.now()-a,b.iterations,d)}this.print()},this.worker.postMessage({delay:this.delay,grid:this.grid,hints:this.hints})}print(){this.printGrid(),this.printHints(),this.printScanner(),this.printController()}printController(){const{ctx:a}=this,{width:c,height:f}=this.canvas,g=b(c,f)/4,h=this.theme.filledColor;a.clearRect(2*c/3-1,2*f/3-1,c/3+1,f/3+1),this.isBusy||(a.save(),a.translate(.7*c,.7*f),a.drawImage(function(){const a=document.createElement("canvas"),b=g/10;a.width=g,a.height=g;const f=a.getContext("2d")||new CanvasRenderingContext2D;return f.translate(g/2,g/2),f.rotate(Math.PI),f.arc(0,0,g/2-b/2,e/2,e/3.9),f.lineWidth=b,f.strokeStyle=h,f.stroke(),f.beginPath(),f.moveTo((g/2+b)*d,(g/2+b)*d),f.lineTo((g/2-2*b)*d,(g/2-2*b)*d),f.lineTo((g/2-2*b)*d,(g/2+b)*d),f.closePath(),f.fillStyle=h,f.fill(),a}(),0,0),a.restore())}printScanner(){if(!this.scanner)return;const{ctx:a}=this,{width:b,height:c}=this.canvas,e=2*b/3/(this.n+1);a.save(),a.translate(e/2,e/2),a.fillStyle=this.isError?this.theme.wrongColor:this.theme.correctColor,a.globalAlpha=.5,"row"===this.scanner.direction?a.fillRect(0,e*this.scanner.i,b,e):"column"===this.scanner.direction&&a.fillRect(e*this.scanner.i,0,e,c),a.restore()}},a.Editor=u,a.Game=class extends k{constructor(a,b,d,{theme:e={},onSuccess:g=()=>{},onAnimationEnd:h=()=>{}}={}){super(),this.brush=c.FILLED,this.draw={},this.isPressed=!1,this.mousedown=a=>{const b=this.canvas.getBoundingClientRect(),e=a.clientX-b.left,g=a.clientY-b.top,h=2*b.width/3/(this.n+1),d=this.getLocation(e,g);if("controller"===d)this.switchBrush();else if("grid"===d){this.draw.firstI=f(g/h-.5),this.draw.firstJ=f(e/h-.5),this.draw.inverted=2===a.button;const b=this.grid[this.draw.firstI][this.draw.firstJ];let d=this.brush;this.draw.inverted&&(d=this.brush===c.FILLED?c.EMPTY:c.FILLED),(b===c.UNSET||d===b)&&(this.draw.mode=d===b?"empty":"filling",this.isPressed=!0,this.switchCell(this.draw.firstI,this.draw.firstJ)),this.draw.lastI=this.draw.firstI,this.draw.lastJ=this.draw.firstJ}},this.mousemove=a=>{if(this.isPressed){const b=this.canvas.getBoundingClientRect(),c=a.clientX-b.left,e=a.clientY-b.top,g=2*b.width/3/(this.n+1);if("grid"===this.getLocation(c,e)){const a=f(e/g-.5),b=f(c/g-.5);(a!==this.draw.lastI||b!==this.draw.lastJ)&&(void 0===this.draw.direction&&(a===this.draw.firstI?this.draw.direction="row":b===this.draw.firstJ&&(this.draw.direction="column")),("row"===this.draw.direction&&a===this.draw.firstI||"column"===this.draw.direction&&b===this.draw.firstJ)&&(this.switchCell(a,b),this.draw.lastI=a,this.draw.lastJ=b))}}},this.brushUp=()=>{this.isPressed=!1,this.draw={}},this.theme.filledColor=i.blue,this.theme.wrongColor=i.grey,this.theme.isMeshed=!0,Object.assign(this.theme,e),this.handleSuccess=g,this.handleAnimationEnd=h,this.hints={row:a.slice(),column:b.slice()},this.removeNonPositiveHints(),this.m=this.hints.row.length,this.n=this.hints.column.length,this.grid=Array(this.m);for(let f=0;f<this.m;f+=1)this.grid[f]=Array(this.n).fill(c.UNSET);this.hints.row.forEach((a,b)=>{a.isCorrect=this.isLineCorrect("row",b)}),this.hints.column.forEach((a,b)=>{a.isCorrect=this.isLineCorrect("column",b)}),this.initCanvas(d),this.startTime=Date.now(),this.print()}initListeners(){this.listeners=[["mousedown",this.mousedown],["mousemove",this.mousemove],["mouseup",this.brushUp],["mouseleave",this.brushUp]]}switchBrush(){this.brush=this.brush===c.EMPTY?c.FILLED:c.EMPTY,this.printController()}switchCell(a,b){let d=this.brush;if(this.draw.inverted&&(d=this.brush===c.FILLED?c.EMPTY:c.FILLED),d===c.FILLED&&this.grid[a][b]!==c.EMPTY){this.grid[a][b]="filling"===this.draw.mode?c.FILLED:c.UNSET,this.hints.row[a].isCorrect=this.isLineCorrect("row",a),this.hints.column[b].isCorrect=this.isLineCorrect("column",b),this.print();const d=this.hints.row.every(a=>!!a.isCorrect)&&this.hints.column.every(a=>!!a.isCorrect);d&&this.succeed()}else d===c.EMPTY&&this.grid[a][b]!==c.FILLED&&(this.grid[a][b]="filling"===this.draw.mode?c.EMPTY:c.UNSET,this.print())}printCell(a){const{ctx:b}=this,e=2*this.canvas.width/3/(this.n+1);a===c.FILLED?(b.fillStyle=this.theme.filledColor,b.fillRect(.05*-e,.05*-e,1.1*e,1.1*e)):a===c.EMPTY?(b.strokeStyle=i.red,b.lineWidth=e/15,b.beginPath(),b.moveTo(.3*e,.3*e),b.lineTo(.7*e,.7*e),b.moveTo(.3*e,.7*e),b.lineTo(.7*e,.3*e),b.stroke()):void 0}printController(){const{ctx:a}=this,{width:d,height:e}=this.canvas,f=b(d,e)/4,g=3*f/4,h=f/4,j=f/20,k=g-2*j,l=()=>{a.save(),a.translate(h,0),a.fillStyle=this.theme.meshColor,a.fillRect(0,0,g,g),a.fillStyle=this.theme.filledColor,a.fillRect(j,j,k,k),a.restore()},m=()=>{a.save(),a.translate(0,h),a.fillStyle=this.theme.meshColor,a.fillRect(0,0,g,g),a.clearRect(j,j,k,k),a.strokeStyle=i.red,a.lineWidth=j,a.beginPath(),a.moveTo(.3*g,.3*g),a.lineTo(.7*g,.7*g),a.moveTo(.3*g,.7*g),a.lineTo(.7*g,.3*g),a.stroke(),a.restore()};a.clearRect(2*d/3-1,2*e/3-1,d/3+1,e/3+1),a.save(),a.translate(.7*d,.7*e),this.brush===c.FILLED?(m(),l()):this.brush===c.EMPTY&&(l(),m()),a.restore()}succeed(){function a(a){var b=Math.pow;return 1+b(a-1,3)}this.handleSuccess(Date.now()-this.startTime),this.listeners.forEach(([a,b])=>{this.canvas.removeEventListener(a,b)});const{ctx:c}=this,{width:d,height:f}=this.canvas,g=b(d,f)/4,h=c.getImageData(0,0,d,f),j=function(){var a=Math.SQRT2;const b=2*g,d=b/10,f=document.createElement("canvas");f.width=b,f.height=b;const h=f.getContext("2d")||new CanvasRenderingContext2D;return h.translate(b/3,5*b/6),h.rotate(-e/4),h.fillStyle=i.green,h.fillRect(0,0,d,-b*a/3),h.fillRect(0,0,2*(b*a)/3,-d),f}();let k=0;const l=()=>{c.putImageData(h,0,0),k+=.03,c.globalAlpha=a(k),c.clearRect(2*d/3,2*f/3,d/3,f/3),c.drawImage(j,.7*d-(1-a(k))*g/2,.7*f-(1-a(k))*g/2,(2-a(k))*g,(2-a(k))*g),1>=k?requestAnimationFrame(l):this.handleAnimationEnd()};l()}},a}({});